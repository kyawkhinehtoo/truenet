import{A as G,N as q}from"./NoData-aKaCzP2A.js";import{P as H}from"./Pagination-LrObDB0A.js";import{i as Q,r as p,D as R,J as X,s as B,c as Z,w as $,N as I,o as i,a as e,d,k as O,x as W,K as ee,n as v,e as c,F as L,g as Y,t as n,b as F,A as te,f as se}from"./app-DWo2jdOY.js";import{M as oe}from"./vue3-multiselect.umd.min-DFBmObM0.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownLink-DnPzcQCc.js";const le={name:"IncidentTask",components:{AppLayout:G,Pagination:H,Multiselect:oe,NoData:q,Link:Q},props:{tasks:Object,errors:Object,permission:Object,user:Object,noc:Object,critical:Number,high:Number,normal:Number,role:Object},setup(u){const t=p("");p("");let m=p(!1),s=p(!1),y=p(!1);p("");let g=p(1),x=p("my");const P=p({date:"YYYY-MM-DD",month:"MMM"});p(!1),R("user",u.user);const l=X({id:null,assigned:null,target:null,status:1,description:null,incident_id:null,data:null});function h(){l.id=null,l.assigned=null,l.target=null,l.status=1,l.description=null,l.data=null,l.incident_id=u.data}function T(a){l.id=a.id,l.assigned=U(a.assigned)?JSON.parse(a.assigned):u.noc.filter(r=>r.id==a.assigned)[0],l.description=a.description,l.incident_id=a.incident_id,l.status=a.status,l.target=a.target,l.data=a,y.value=!0,s.value=!0}function j(a){a.status!=2?Toast.fire({title:"Are you sure?",text:"Do you want to mark as completed !",icon:"warning",timer:!1,position:"center",showCancelButton:!0,dangerMode:!0}).then(r=>{r.isConfirmed&&b(a,2)}):Toast.fire({title:"Are you sure?",text:"Do you want to mark as WIP !",icon:"warning",timer:!1,position:"center",showCancelButton:!0,dangerMode:!0}).then(r=>{r.isConfirmed&&b(a,1)})}function b(a,r){l.id=a.id,l.assigned=a.assigned,l.description=a.description,l.incident_id=a.incident_id,l.status=r,l.target=a.target,y.value=!0,s.value=!1,_()}function _(){y.value!=!0?(l._method="POST",I.post("/addTask",l,{preserveState:!0,onSuccess:a=>{s.value=!1,h(),Toast.fire({icon:"success",title:a.props.flash.message})},onError:a=>{console.log("error .."+a)}})):(l._method="PUT",I.post("/editTask/"+l.id,l,{onSuccess:a=>{s.value=!1,y.value=!1,h(),Toast.fire({icon:"success",title:a.props.flash.message})},onError:a=>{console.log("error .."+a)}}))}function C(){s.value=!1,preserveState=!0}function A(a){let r="WIP";return a==0?r="Deleted":a==1?r="WIP":r="Completed",r}function S(){I.get("/mytask/",{keyword:t.value,status:g.value,task:x.value},{preserveState:!0})}function f(){let a="/mytask/";t.value!=null&&(a=a+"?keyword="+t.value),g.value!=""&&(a=a+"&status="+g.value),x.value!=""&&(a=a+"&task="+x.value),I.get(a,{keyword:t.value},{preserveState:!0})}function D(){g.value=1,f()}function o(){g.value=2,f()}function M(){g.value="all",f()}function w(){x.value="my",f()}function V(){x.value="all",f()}const K=a=>{var r,z;if(U(a)){let k=JSON.parse(a);if(console.log(k),!Array.isArray(k)&&k instanceof Object)return(z=k.name)==null?void 0:z.match(/\b\w/g).join("");{let N=""+k.map(J=>{var E;return console.log(J.name),(E=J.name)==null?void 0:E.match(/\b\w/g).join("")});return console.log(N),N}}else return(r=Object(u.noc.filter(N=>N.id==a)[0]).name)==null?void 0:r.match(/\b\w/g).join("")};function U(a){console.log(a);try{const r=JSON.parse(a);return typeof r=="object"&&r!==null}catch{return console.log("not json"),!1}}return{search:t,loading:m,form:l,formatter:P,edit:s,editMode:y,search_status:g,task_user:x,getName:K,getStatus:A,editTask:T,completeIt:b,saveTask:_,cancelTask:C,completeTask:j,searchTask:S,goWIP:D,goCompleted:o,goAll:M,goMyTasks:w,goAllTasks:V,changeStatus:f}}},ne={class:"py-1"},ie={class:"mx-auto sm:px-6 lg:px-8"},de={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-2 py-2 w-full justify-items-end"},re={class:"flex w-full"},ce={class:"flex w-full"},me={class:"flex w-full"},ue={key:1},pe={key:0,class:"hidden md:block"},fe={class:"min-w-full divide-y divide-gray-200 table-auto"},ge={class:"bg-white divide-y divide-gray-200 text-sm w-full text-left"},xe={class:"px-2 py-3 whitespace-nowrap"},ye={class:"px-6 py-3 whitespace-nowrap w-1/12"},be=["checked","onClick","disabled"],ke={class:"px-6 py-3 whitespace-nowrap"},ve={class:"px-6 py-3 whitespace-nowrap"},he={class:"px-6 py-3 whitespace-nowrap"},_e={class:"px-6 py-3 whitespace-nowrap"},we={class:"px-6 py-3 whitespace-nowrap"},Te={class:"px-6 py-3 whitespace-nowrap"},je={class:"px-6 py-3 whitespace-nowrap"},Ce=["onClick"],Ae={key:1,class:"grid grid-cols-1 sm:grid-cols-2 gap-2 md:hidden"},Se={class:"flex items-center justify-between space-x-2 text-sm"},De={class:"font-bold"},Me={class:"text-sm text-gray-600"},Ne={class:"font-sm p-2 capitalize"},Ie={class:"mt-4"},Oe={class:"text-xs text-gray-700"},Pe={class:"text-xs text-gray-700"},Ve={class:"text-xs text-gray-700"},Be={class:"flex flex-wrap justify-end"},We=["onClick"],Ue={key:2,class:"w-full block mt-4"},ze={class:"text-xs text-gray-600"},Je={key:3},Ee={key:2,class:"grid grid-cols-1 md:grid-cols-4 gap-2 w-full bg-white p-4"},Le={class:"md:py-2 md:col-span-3 col-span-1"},Ye={class:"flex"},Fe={for:"ftth_id",class:"block text-sm font-bold text-gray-700 md:mt-2 md:mr-2"},Ke={class:"md:py-2 md:col-span-3 col-span-1"},Ge={class:"flex"},qe={for:"type",class:"block text-sm font-bold text-gray-700 md:mt-2 md:mr-2 capitalize"},He={key:0,class:"py-2 col-span-1 w-full"},Qe={key:1,class:"md:py-2 md:col-span-3 col-span-1"},Re={class:"flex"},Xe={for:"type",class:"block text-sm font-bold text-gray-700 md:mt-2 md:mr-2 capitalize"},Ze={class:"md:py-2 md:col-span-3 col-span-1"},$e={class:"flex"},et={for:"type",class:"block text-sm font-bold text-gray-700 md:mt-2 md:mr-2 whitespace-normal"},tt={class:"md:py-2 md:col-span-3 col-span-1"},st={class:"flex"},ot={for:"type",class:"block text-sm font-bold text-gray-700 md:mt-2 md:mr-2 whitespace-normal"},at={class:"md:py-2 md:col-span-3 col-span-1"},lt={class:"flex rounded-md shadow-sm"},nt={key:0,class:"flex rounded-md shadow-sm w-full"},it={key:1,class:"mt-2 text-sm text-red-500"},dt={class:"md:py-2 col-span-1 md:col-span-3"},rt={class:"flex rounded-md shadow-sm"},ct={key:0,class:"mt-2 text-sm text-red-500"},mt={class:"md:py-2 col-span-1 md:col-span-3"},ut={class:"flex rounded-md shadow-sm"},pt={key:0,class:"mt-2 text-sm text-red-500"},ft={class:"md:py-2 col-span-1 md:col-span-3"},gt={class:"flex rounded-md shadow-sm"},xt={key:0,class:"mt-2 text-sm text-red-500"},yt={class:"col-span-1 md:col-span-4 flex md:justify-end justify-between mt-4"},bt={key:0},kt={key:1},vt={key:0,"wire:loading":"",class:"fixed top-0 left-0 right-0 bottom-0 w-full h-screen z-50 overflow-hidden bg-gray-700 opacity-75 flex flex-col items-center justify-center"};function ht(u,t,m,s,y,g){const x=B("pagination"),P=B("multiselect"),l=B("app-layout");return i(),Z(l,null,{default:$(()=>{var h,T,j,b,_,C,A,S,f,D;return[e("div",ne,[e("div",ie,[s.edit?c("",!0):(i(),d("div",de,[e("div",re,[t[13]||(t[13]=e("span",{class:"z-10 mt-1 leading-snug font-normal text-center text-blueGray-300 absolute bg-transparent rounded text-base items-center justify-center w-8 pl-3 py-2"},[e("i",{class:"fas fa-search"})],-1)),O(e("input",{type:"text",placeholder:"ID/Description",class:"pl-10 pr-12 py-2.5 w-full rounded-lg overflow-hidden text-sm text-litepie-secondary-700 placeholder-litepie-secondary-400 transition-colors bg-white border border-litepie-secondary-300 focus:border-litepie-primary-300 focus:ring focus:ring-litepie-primary-500 focus:ring-opacity-10 focus:outline-none dark:bg-litepie-secondary-800 dark:border-litepie-secondary-700 dark:text-litepie-secondary-100 dark:placeholder-litepie-secondary-500 dark:focus:border-litepie-primary-500 dark:focus:ring-opacity-20",id:"search",tabindex:"1","onUpdate:modelValue":t[0]||(t[0]=o=>s.search=o),onKeyup:t[1]||(t[1]=ee((...o)=>s.searchTask&&s.searchTask(...o),["enter"]))},null,544),[[W,s.search]])]),e("div",ce,[e("button",{class:v(["w-full btn py-3 px-8 bg-gray-400 rounded rounded-r-none focus:ring-0 focus:border-transparent focus:outline-none focus:shadow-inner text-gray-50 text-xs font-semibold uppercase",{"bg-yellow-300 text-gray-600 font-bold":s.search_status==1}]),onClick:t[2]||(t[2]=(...o)=>s.goWIP&&s.goWIP(...o))},"WIP",2),e("button",{class:v(["w-full btn py-3 px-8 bg-gray-400 focus:ring-0 focus:border-transparent focus:outline-none focus:shadow-inner text-gray-50 text-xs font-semibold uppercase",{"bg-green-300 text-gray-600 font-bold":s.search_status==2}]),onClick:t[3]||(t[3]=(...o)=>s.goCompleted&&s.goCompleted(...o))},"Completed",2),e("button",{class:v(["w-full btn py-3 px-8 bg-gray-400 rounded rounded-l-none focus:ring-0 focus:border-transparent focus:outline-none focus:shadow-inner text-gray-50 text-xs font-semibold uppercase",{"bg-indigo-600 font-bold":s.search_status=="all"}]),onClick:t[4]||(t[4]=(...o)=>s.goAll&&s.goAll(...o))},"All",2)]),e("div",me,[e("button",{class:v(["w-full btn py-3 px-8 bg-gray-400 rounded rounded-r-none focus:ring-0 focus:border-transparent focus:outline-none focus:shadow-inner text-gray-50 text-xs font-semibold uppercase",{"bg-yellow-300 text-gray-600 font-bold":s.task_user=="my"}]),onClick:t[5]||(t[5]=(...o)=>s.goMyTasks&&s.goMyTasks(...o))},"My Tasks",2),e("button",{class:v(["w-full btn py-3 px-8 bg-gray-400 rounded rounded-l-none focus:ring-0 focus:border-transparent focus:outline-none focus:shadow-inner text-gray-50 text-xs font-semibold uppercase",{"bg-indigo-600 font-bold":s.task_user=="all"}]),onClick:t[6]||(t[6]=(...o)=>s.goAllTasks&&s.goAllTasks(...o))},"All",2)])])),s.edit?c("",!0):(i(),d("div",ue,[(h=m.tasks)!=null&&h.data?(i(),d("div",pe,[e("table",fe,[t[15]||(t[15]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Customer ID"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Description"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Assigned To"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Assigned By"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Target Date"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Action")])],-1)),e("tbody",ge,[(i(!0),d(L,null,Y(m.tasks.data,(o,M)=>{var w;return i(),d("tr",{key:o.id},[e("td",xe,n(M+=m.tasks.from),1),e("td",ye,[e("input",{type:"checkbox",name:"status",checked:o.status==2,onClick:V=>s.completeTask(o),disabled:!m.permission[0].write_incident},null,8,be)]),e("td",ke,n(o.ftth_id),1),e("td",ve,n((w=o.description)==null?void 0:w.substring(0,50)),1),e("td",he,n(s.getName(o.assigned)),1),e("td",_e,n(o.incharge.match(/\b\w/g).join("")),1),e("td",we,n(o.target),1),e("td",Te,n(s.getStatus(o.status)),1),e("td",je,[e("a",{href:"#",onClick:V=>s.editTask(o),class:"text-blue-600"},t[14]||(t[14]=[e("i",{class:"fa fa-edit"},null,-1)]),8,Ce)])])}),128))])])])):c("",!0),(T=m.tasks)!=null&&T.data?(i(),d("div",Ae,[(i(!0),d(L,null,Y(m.tasks.data,(o,M)=>(i(),d("div",{class:"bg-white p-4 rounded-lg shadow mt-2 space-y-1 text-gray-600",key:o.id},[e("div",Se,[e("label",De,n(o.ftth_id),1),e("div",null,[e("span",{class:v(["text-xs font-bold px-2.5 py-0.5 rounded items-center justify-center",{"bg-yellow-400":o.status==1,"bg-green-300":o.status!=1}])},n(s.getStatus(o.status)),3)])]),e("div",Me,[t[16]||(t[16]=e("label",{for:"details",class:"w-full font-bold"}," Description ",-1)),e("p",Ne,n(o.description),1)]),e("span",Ie,[e("div",Oe," Assigned To : "+n(o.assigned_to),1),e("div",Pe," Assigned By : "+n(o.incharge),1),e("div",Ve," Target Date : "+n(o.target),1)]),e("div",Be,[e("div",null,[e("a",{type:"button",onClick:w=>s.editTask(o),href:"#",class:"bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-green-900 dark:text-green-30 items-center justify-center"},t[17]||(t[17]=[e("span",{class:"text-sm"},"Edit",-1),e("i",{class:"fa fa-angle-double-right fa-lg ml-2","aria-hidden":"true"},null,-1)]),8,We)])])]))),128))])):c("",!0),m.tasks.total?(i(),d("span",Ue,[e("label",ze,n(m.tasks.data.length)+" Tasks in Current Page. Total Number of Tasks : "+n(m.tasks.total),1)])):c("",!0),m.tasks.links?(i(),d("span",Je,[F(x,{class:"mt-4",links:m.tasks.links},null,8,["links"])])):c("",!0)])),s.edit?(i(),d("div",Ee,[t[22]||(t[22]=e("div",{class:"py-2 col-span-1 w-full"},[e("div",{class:"flex md:justify-end"},[e("label",{for:"assigned",class:"block text-sm font-medium text-gray-700 md:mt-2 md:mr-2"}," Customer ID : ")])],-1)),e("div",Le,[e("div",Ye,[e("label",Fe,n((j=s.form.data)==null?void 0:j.ftth_id),1)])]),t[23]||(t[23]=e("div",{class:"py-2 col-span-1 w-full"},[e("div",{class:"flex md:justify-end"},[e("label",{for:"assigned",class:"block text-sm font-medium text-gray-700 md:mt-2 md:mr-2"}," Ticket Type : ")])],-1)),e("div",Ke,[e("div",Ge,[e("label",qe,n((b=s.form.data)==null?void 0:b.type.replace("_"," ")),1)])]),(_=s.form.data)!=null&&_.topic?(i(),d("div",He,t[18]||(t[18]=[e("div",{class:"flex md:justify-end"},[e("label",{for:"assigned",class:"block text-sm font-medium text-gray-700 md:mt-2 md:mr-2"}," Ticket Topic : ")],-1)]))):c("",!0),(C=s.form.data)!=null&&C.topic?(i(),d("div",Qe,[e("div",Re,[e("label",Xe,n((A=s.form.data)==null?void 0:A.topic.replace("_"," ")),1)])])):c("",!0),t[24]||(t[24]=e("div",{class:"py-2 col-span-1 w-full"},[e("div",{class:"flex md:justify-end"},[e("label",{for:"assigned",class:"block text-sm font-medium text-gray-700 md:mt-2 md:mr-2"}," Ticket Detail : ")])],-1)),e("div",Ze,[e("div",$e,[e("label",et,n((S=s.form.data)==null?void 0:S.incident_description),1)])]),t[25]||(t[25]=e("div",{class:"py-2 col-span-1 w-full"},[e("div",{class:"flex md:justify-end"},[e("label",{for:"assigned",class:"block text-sm font-medium text-gray-700 md:mt-2 md:mr-2"}," Ticket Opened At : ")])],-1)),e("div",tt,[e("div",st,[e("label",ot,n((f=s.form.data)==null?void 0:f.date)+" : "+n((D=s.form.data)==null?void 0:D.time),1)])]),t[26]||(t[26]=e("div",{class:"py-2 col-span-1 w-full"},[e("div",{class:"flex md:justify-end"},[e("label",{for:"assigned",class:"block text-sm font-medium text-gray-700 md:mt-2 md:mr-2"}," Assigned : ")])],-1)),e("div",at,[e("div",lt,[m.noc.length!==0?(i(),d("div",nt,[F(P,{"deselect-label":"Selected already",options:m.noc,"track-by":"id",label:"name",modelValue:s.form.assigned,"onUpdate:modelValue":t[7]||(t[7]=o=>s.form.assigned=o),"allow-empty":!1,multiple:!0},null,8,["options","modelValue"])])):c("",!0),u.$page.props.errors.assigned?(i(),d("p",it,n(u.$page.props.errors.assigned),1)):c("",!0)])]),t[27]||(t[27]=e("div",{class:"py-2 col-span-1 sm:col-span-1"},[e("div",{class:"flex md:justify-end"},[e("label",{for:"target",class:"block text-sm font-medium text-gray-700 md:mt-2 md:mr-2"}," Target : ")])],-1)),e("div",dt,[e("div",rt,[O(e("input",{type:"date","onUpdate:modelValue":t[8]||(t[8]=o=>s.form.target=o),name:"target",id:"target",class:"form-input focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-md sm:text-sm border-gray-300"},null,512),[[W,s.form.target]])]),u.$page.props.errors.target?(i(),d("p",ct,n(u.$page.props.errors.target),1)):c("",!0)]),t[28]||(t[28]=e("div",{class:"py-2 col-span-1 sm:col-span-1"},[e("div",{class:"flex md:justify-end"},[e("label",{for:"description",class:"block text-sm font-medium text-gray-700 md:mt-2 md:mr-2"}," Description : ")])],-1)),e("div",mt,[e("div",ut,[O(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=o=>s.form.description=o),name:"description",id:"description",class:"form-input focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-md sm:text-sm border-gray-300"},null,512),[[W,s.form.description]])]),u.$page.props.errors.description?(i(),d("p",pt,n(u.$page.props.errors.description),1)):c("",!0)]),t[29]||(t[29]=e("div",{class:"py-2 col-span-1 sm:col-span-1"},[e("div",{class:"flex md:justify-end"},[e("label",{for:"description",class:"block text-sm font-medium text-gray-700 md:mt-2 md:mr-2"}," Status : ")])],-1)),e("div",ft,[e("div",gt,[O(e("select",{"onUpdate:modelValue":t[10]||(t[10]=o=>s.form.status=o),class:"focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-md sm:text-sm border-gray-300"},t[19]||(t[19]=[e("option",{value:"1"},"WIP",-1),e("option",{value:"2"},"Completed",-1),e("option",{value:"0"},"Deleted",-1)]),512),[[te,s.form.status]])]),u.$page.props.errors.status?(i(),d("p",xt,n(u.$page.props.errors.status),1)):c("",!0)]),e("div",yt,[e("a",{href:"#",onClick:t[11]||(t[11]=o=>s.saveTask()),class:"text-center px-4 py-3 bg-green-500 border border-transparent rounded-sm font-semibold text-xs text-white uppercase tracking-widest hover:bg-green-400 active:bg-green-600 focus:outline-none focus:border-gray-900 disabled:opacity-25 transition mr-1"},[s.editMode?c("",!0):(i(),d("span",bt,"Save Task")),s.editMode?(i(),d("span",kt,"Update Task")):c("",!0),t[20]||(t[20]=e("i",{class:"fas fa-save opacity-75 ml-1 text-sm"},null,-1))]),e("a",{href:"#",onClick:t[12]||(t[12]=o=>s.cancelTask()),class:"text-center px-4 py-3 bg-gray-500 border border-transparent rounded-sm font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-400 active:bg-gray-600 focus:outline-none focus:border-gray-900 disabled:opacity-25 transition"},t[21]||(t[21]=[se("Cancel"),e("i",{class:"fas fa-save opacity-75 ml-1 text-sm"},null,-1)]))])])):c("",!0)])]),s.loading?(i(),d("div",vt,t[30]||(t[30]=[e("div",{class:"loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4"},null,-1),e("h2",{class:"text-center text-white text-xl font-semibold"},"Loading...",-1),e("p",{class:"w-1/3 text-center text-white"},"This may take a few seconds, please don't close this page.",-1)]))):c("",!0)]}),_:1})}const St=ae(le,[["render",ht]]);export{St as default};
